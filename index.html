<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css" />
  <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-router-dom/5.0.1/react-router-dom.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Work+Sans:400,600,700&display=swap" rel="stylesheet">
  <title>Note Taker</title>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { render } = ReactDOM;
    const { Component } = React;
    const { HashRouter, NavLink, Switch, Link, Route, Redirect } = ReactRouterDOM;
    const API = 'https://acme-users-api-rev.herokuapp.com/api';

    const fetchUser = async ()=> {
      const storage = window.localStorage;
      const userId = storage.getItem('userId');
      if(userId){
        try {
          return (await axios.get(`${API}/users/detail/${userId}`)).data;
        }
        catch(ex){
          storage.removeItem('userId');
          return fetchUser();
        }
      }
      const user = (await axios.get(`${API}/users/random`)).data;
      storage.setItem('userId', user.id);
      return user;
    };



    // class Note extends Component {
    //   constructor(){
    //     super();
    //     this.state = {
    //       note: {}
    //     }
    //   }
    //   render(){
    //     const {note} = this.props
    //     return(<p>
    //     {note.text}
    //     </p>
    //     )
    //   }
    // }

    const renderNote = (note) => {
      const archText = note.archived ? "Unarchive" : "Archive";
      return (
        <div key={note.id}>
          <li>{note.text}</li>
          <button>{archText}</button>
          <button>Destroy</button>
        </div>
      );
    }

    class Create extends Component {
      constructor() {
        super();
        this.state = 
      }
    }

    class App extends Component {
      constructor() {
        super();
        this.state = {
          user: {},
          notes: []
        }
      }
      async componentDidMount() {
        const user = await fetchUser();
        console.log(user);
        const notes = await axios.get(`${API}/users/${user.id}/notes`);
        console.log(notes.data);
        this.setState({ user:user, notes: notes.data});
      }
      render() {
        const { user, notes } = this.state;
        const unarchived = notes.filter(note => !note.archived)
        const archived = notes.filter(note => note.archived)
        return (
          <HashRouter>
            <nav>
              <ul>
                <NavLink to = '/notes' activeClassName = 'selected'>Notes ({unarchived.length})</NavLink>
                <NavLink to = '/archived' activeClassName = 'selected'>Archived ({archived.length})</NavLink>
                <NavLink to = '/create' activeClassName = 'selected'>Create</NavLink>
              </ul>
              <h1>Acme Note-taker for { user.fullName }</h1>
            </nav>
            <Switch>
              <Route path = '/notes' render = {() => <ul>{ unarchived.map(note => renderNote(note)) }</ul>} />
              <Route path = '/archived' render = {() => <ul>{ archived.map(note => renderNote(note)) }</ul>} />
              <Route path = '/create' render = {() => <h1>Create!</h1>} />
              <Redirect to='/notes' />
            </Switch>
          </HashRouter>
        );
      }
    }

    const root = document.querySelector("#root");
    render(<App />, root);
  </script>
</body>
</html>
